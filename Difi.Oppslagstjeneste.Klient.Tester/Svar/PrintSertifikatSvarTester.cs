using System;
using System.Security.Cryptography.X509Certificates;
using System.Xml;
using Difi.Oppslagstjeneste.Klient.Svar;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace Difi.Oppslagstjeneste.Klient.Tester.Svar
{
    [TestClass]
    public class PrintSertifikatSvarTester
    {
        private static PrintSertifikatSvar _printSertifikatSvar;

        [ClassInitialize]
        public static void Init(TestContext context)
        {
            try
            {
                var xmlDocument = new XmlDocument();
                xmlDocument.LoadXml(Envelope());

                _printSertifikatSvar = new PrintSertifikatSvar(xmlDocument);
            }
            catch
            {
                Assert.Fail();
            }
        }

        [TestMethod]
        public void HentSertifikatSuksess()
        {
            var expectedThumb =
                new X509Certificate2(
                    Convert.FromBase64String(
                        @"MIIE7jCCA9agAwIBAgIKGBZrmEgzTHzeJjANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzA1MVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCLCxU4oBhtGmJxXZWbdWdzO2uA3eRNW/kPdddL1HYl1iXLV/g+H2Q0ELadWLggkS+1kOd8/jKxEN++biMmmDqqCWbzNdmEd1j4lctSlH6M7tt0ywmXIYdZMz5kxcLAMNXsaqnPdikI9uPJZQEL3Kc8hXhXISvpzP7gYOvKHg41uCxu1xCZQOM6pTlNbxemBYqvES4fRh2xvB9aMjwkB4Nz8jrIsyoPI89i05OmGMkI5BPZt8NTa40Yf3yU+SQECW0GWalB5cxaTMeB01tqslUzBJPV3cQx+AhtQG4hkOhQnAMDJramSPVtwbEnqOjQ+lyNmg5GQ4FJO02ApKJTZDTHAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBQ1gsJfVC7KYGiWVLP7ZwzppyVYTTAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCe67UOZ/VSwcH2ov1cOSaWslL7JNfqhyNZWGpfgX1c0Gh+KkO3eVkMSozpgX6M4eeWBWJGELMiVN1LhNaGxBU9TBMdeQ3SqK219W6DXRJ2ycBtaVwQ26V5tWKRN4UlRovYYiY+nMLx9VrLOD4uoP6fm9GE5Fj0vSMMPvOEXi0NsN+8MUm3HWoBeUCLyFpe7/EPsS/Wud5bb0as/E2zIztRodxfNsoiXNvWaP2ZiPWFunIjK1H/8EcktEW1paiPd8AZek/QQoG0MKPfPIJuqH+WJU3a8J8epMDyVfaek+4+l9XOeKwVXNSOP/JSwgpOJNzTdaDOM+uVuk75n2191Fd7"))
                    .Thumbprint;
            var actualThumb = _printSertifikatSvar.Printsertifikat.Thumbprint;
            Assert.AreEqual(expectedThumb, actualThumb);
        }

        [TestMethod]
        public void HentPostkasseleverandørAdresseSuksess()
        {
            Assert.AreEqual("984661185", _printSertifikatSvar.PostkasseleverandørAdresse);
        }

        private static string Envelope()
        {
            return
                "<env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"><env:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\"><xenc:EncryptedKey xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\" Id=\"EK-93174122FB0647AACA1455889558917347830\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\" /><ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><wsse:SecurityTokenReference><ds:X509Data><ds:X509IssuerSerial><ds:X509IssuerName>CN=Buypass Class 3 Test4 CA 3,O=Buypass AS-983163327,C=NO</ds:X509IssuerName><ds:X509SerialNumber>113797202800340228423187</ds:X509SerialNumber></ds:X509IssuerSerial></ds:X509Data></wsse:SecurityTokenReference></ds:KeyInfo><xenc:CipherData><xenc:CipherValue>YsQpqiAcLCUURs2MHFl/HT7CVHRv0CIPhiMZkF5zS4kso4WpGzwFeYWL8vgiw8LCzCGc+Io0lcRZocVwxm9alV+66Fivfr+GqLPUbG6YaUMc2VfFt35MNodKqcja/0d0kZL3JuSA4q5GCagVhw+SvxSwvdHWKQDWoDd4dj5/9sG5XECALED55/AN9oGZG+f/3sCh1L6whfinlqbcu1I6o53J/akoFbVWW5RBUnoINzJFBaVWc5uhU7MKRN1JZ2+HrSql8wv8oImFzGL5T2jTPMsgKNjk1FGjXGB2Ov8ZjvKdagtJ+ey6TIV8RB2jQ4M7sLksDCJX8fQPmz6H7KVGjA==</xenc:CipherValue></xenc:CipherData><xenc:ReferenceList><xenc:DataReference URI=\"#ED-93174122FB0647AACA1455889558917347831\" /></xenc:ReferenceList></xenc:EncryptedKey><wsse:BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" wsu:Id=\"X509-93174122FB0647AACA1455889558905347825\">MIIE9zCCA9+gAwIBAgIKMbZ4wGiF3IUUOzANBgkqhkiG9w0BAQUFADBLMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxHTAbBgNVBAMMFEJ1eXBhc3MgQ2xhc3MgMyBDQSAzMB4XDTEzMDMwNzE0MDAzOFoXDTE2MDMwNzE0MDAzNVowgYsxCzAJBgNVBAYTAk5PMSwwKgYDVQQKDCNESVJFS1RPUkFURVQgRk9SIEZPUlZBTFROSU5HIE9HIElLVDEMMAoGA1UECwwDVkVSMSwwKgYDVQQDDCNESVJFS1RPUkFURVQgRk9SIEZPUlZBTFROSU5HIE9HIElLVDESMBAGA1UEBRMJOTkxODI1ODI3MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtRTwCP3aPXB61np2eF+ebEZTTz8ebMzSfpin8bbga65jubLOSN28JQHysCBZryghJkUHhs+xL8wP85DEpCT7DoIe+9Hyx84Ei2eHkpO5B4HaY8c1s6X2iABvEUC7TsHxvsf71ORuP77/CtR4U29BH4X0OUGu3yKJOUWSYfiHyIpwPkcdNs1jSkrvy6HJeCY0ICmdqTv/PzhHXS2pnGOt7aMkMQuHxmlgFO/wUeRmP4Rff3AUOPrPwk7OMhCeB219l7TNcd9Tb5xKySeVWDuHYzfjCM+5V86ZBNaGe6eFHfiFUMmGkmxtzcUqIsmSCH1fwIVBTpfnE6MS4WMo6TfsKQIDAQABo4IBmjCCAZYwCQYDVR0TBAIwADAfBgNVHSMEGDAWgBTMw/gHt5xtek71pysdBfmzRxyR0TAdBgNVHQ4EFgQUR3iI9AQJNcfdr1Pp2c25VNGVAkUwDgYDVR0PAQH/BAQDAgSwMBUGA1UdIAQOMAwwCgYIYIRCARoBAwIwgaUGA1UdHwSBnTCBmjAvoC2gK4YpaHR0cDovL2NybC5idXlwYXNzLm5vL2NybC9CUENsYXNzM0NBMy5jcmwwZ6BloGOGYWxkYXA6Ly9sZGFwLmJ1eXBhc3Mubm8vZGM9QnV5cGFzcyxkYz1OTyxDTj1CdXlwYXNzJTIwQ2xhc3MlMjAzJTIwQ0ElMjAzP2NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3QwegYIKwYBBQUHAQEEbjBsMDMGCCsGAQUFBzABhidodHRwOi8vb2NzcC5idXlwYXNzLm5vL29jc3AvQlBDbGFzczNDQTMwNQYIKwYBBQUHMAKGKWh0dHA6Ly9jcnQuYnV5cGFzcy5uby9jcnQvQlBDbGFzczNDQTMuY2VyMA0GCSqGSIb3DQEBBQUAA4IBAQDZpzajceMe9vwzY01BIafvcLX70WHxNUz2q5beYxW1+RDchr6wvznTChhpmuPuWp3Kuq9nD7kkZgIaiqUcjH1Fuv2Jo0wEC8OtJAlUfIcyGh/o3s/u761Qq84viEV50cyXaUX9ryzdDgkxujgx1nFY0rnGWiHoM1jDSglTLfCOrd/ofF+Mr9gLVFl+AlZ3waIbhidlEC0fw05OTXPJ9sc3LJ+1QwV3DsZwjciL+ZIqS2Cg4NXvNe1C8KpGUGoPN4gBWleB8WjyY1uTyz8ssE9+8ETMWnxCrxY6/rfm01iK0ZSFtqYl9Wdg1xydkaTOrtGwi422Y0KOzixrsau1eMRh</wsse:BinarySecurityToken><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" Id=\"SIG-93174122FB0647AACA1455889558912347829\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><ds:Reference URI=\"#TS-93174122FB0647AACA1455889558905347824\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>Du+TEH2aJ7fmjK50UCxT+Nho9ap/w71yvRPtNEpycBA=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#id-93174122FB0647AACA1455889558905347828\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>sknTNVg9KQ24y/RII/4FyKqoqGILz1zfFAtDUeEXCuY=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#SC-93174122FB0647AACA1455889558905347823\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>LDHjjXkLgYJd1/487e5N1GNXVYmbNqVB2p8x2fl87Ro=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>ACJt2wJ0oKQc85RfeTo2oz/Myvy1oLULQ6Vqy+z8kDQwFWtaHraiuOE83fkcLTEYy9wJJiEW8sjDrC8HqzpVsQCw7jVcuZ/U28M0qCwFt/lTzhQejaPM/gxheoZqSwaNLx6dgPLIxPDZlBF3djZxtMuMgAr4DsO3BOxC2hJ3ElMVdoMCPyauY30qOHGiiVGqZEOQC+HD93DHU/7Td5zHlYko1TmmhX5leYaiFyKSTPdNoSh/KQlXVvkJIFvy5H+qHD40kiJ4jNX5YhNlpAiHV2I6YWcEHT1oNkmtOrqVImYo/KEGd93Jm2YlUcK85T/o4+Fq8Hp6BUQAn5i/VnrnyA==</ds:SignatureValue><ds:KeyInfo Id=\"KI-93174122FB0647AACA1455889558905347826\"><wsse:SecurityTokenReference wsu:Id=\"STR-93174122FB0647AACA1455889558905347827\"><wsse:Reference URI=\"#X509-93174122FB0647AACA1455889558905347825\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" /></wsse:SecurityTokenReference></ds:KeyInfo></ds:Signature><wsu:Timestamp wsu:Id=\"TS-93174122FB0647AACA1455889558905347824\"><wsu:Created>2016-02-19T13:45:58.905Z</wsu:Created><wsu:Expires>2016-02-19T13:46:58.905Z</wsu:Expires></wsu:Timestamp><wsse11:SignatureConfirmation xmlns:wsse11=\"http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd\" Value=\"bUT2TiO/TxkXdZEPVr6C348pcUz8hp3lpc+XF9wpXPjU6rDM784yaTNBtAUKeHAEc/8JKPxJCkNoniUiCFbkyin64EioSbPYLG42mFknA43dp7X76ObWivJaFrw2KY6Dn30gbA7P8skNfE2AMHtq9WOLaUYcaQrk+aPpZtiNHI+gus8sXOHZrcLHeh5hWGzb24PXW1q5VAQMi+iSIw0QlKcB0x1Ha+v70mX/KQ16iGAFs1V5cnYt0NNipzr3Uk9cy4mymldCB/arH/FMMzOYta6a8Zly7EE8JEPaQ/VWtB2jQ1dRcTAF2AEbeXuUw/t8MzaYBx7WTLtnLF9ieZv1ww==\" wsu:Id=\"SC-93174122FB0647AACA1455889558905347823\" /></wsse:Security></env:Header><env:Body xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" wsu:Id=\"id-93174122FB0647AACA1455889558905347828\"><ns2:HentPrintSertifikatRespons xmlns:ns2=\"http://kontaktinfo.difi.no/xsd/oppslagstjeneste/16-02\"><ns2:postkasseleverandoerAdresse>984661185</ns2:postkasseleverandoerAdresse><ns2:X509Sertifikat>MIIE7jCCA9agAwIBAgIKGBZrmEgzTHzeJjANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzA1MVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCLCxU4oBhtGmJxXZWbdWdzO2uA3eRNW/kPdddL1HYl1iXLV/g+H2Q0ELadWLggkS+1kOd8/jKxEN++biMmmDqqCWbzNdmEd1j4lctSlH6M7tt0ywmXIYdZMz5kxcLAMNXsaqnPdikI9uPJZQEL3Kc8hXhXISvpzP7gYOvKHg41uCxu1xCZQOM6pTlNbxemBYqvES4fRh2xvB9aMjwkB4Nz8jrIsyoPI89i05OmGMkI5BPZt8NTa40Yf3yU+SQECW0GWalB5cxaTMeB01tqslUzBJPV3cQx+AhtQG4hkOhQnAMDJramSPVtwbEnqOjQ+lyNmg5GQ4FJO02ApKJTZDTHAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBQ1gsJfVC7KYGiWVLP7ZwzppyVYTTAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCe67UOZ/VSwcH2ov1cOSaWslL7JNfqhyNZWGpfgX1c0Gh+KkO3eVkMSozpgX6M4eeWBWJGELMiVN1LhNaGxBU9TBMdeQ3SqK219W6DXRJ2ycBtaVwQ26V5tWKRN4UlRovYYiY+nMLx9VrLOD4uoP6fm9GE5Fj0vSMMPvOEXi0NsN+8MUm3HWoBeUCLyFpe7/EPsS/Wud5bb0as/E2zIztRodxfNsoiXNvWaP2ZiPWFunIjK1H/8EcktEW1paiPd8AZek/QQoG0MKPfPIJuqH+WJU3a8J8epMDyVfaek+4+l9XOeKwVXNSOP/JSwgpOJNzTdaDOM+uVuk75n2191Fd7</ns2:X509Sertifikat></ns2:HentPrintSertifikatRespons></env:Body></env:Envelope>";
        }
    }
}